#opencps-agent

新版本 智能体版本

### 下个版本计划

##### 重新构建控制命令 
具体任务：

1. 拆解控制命令
2. 将输入条件与输出条件分离
3. 将任务分别部署的输入与输出节点
4. 通过输出节点检测是否需要执行其他节点的控制命令，方便以后加入智能算法
5. 跳出状态机的输入与输出模式，实际上改为：单元自己思考，思考之后将自己的结果通知其他单元；其他单元接收到消息之后开始思考自己是否接收这条控制命令，或综合考虑多项其他单元的输入。

控制命令具体项目:

|编号|命令|参数|范例|说明|返回值|
|----|----|----|----|----|------|
|1|create|int(default=1)|"controller&create 2"|创建物联网应用（默认为1）|项目ID|
|2|add&input|command|"controller&add:taskid&input&">30;ip:port"|添加输入控制节点信息|任务ID/False|
|3|add&output|command|"controller&add:taskid&output&[任务ID1,任务ID2]:command"|检测是否收到预设任务ID的消息，收到则执行操作|任务ID/False|
|4|start|项目ID|"controller&start Taskid"|启动物联网应用|True/False|
|5|delete|项目ID|"controller&delete Taskid"|删除物联网应用|True/False|
|6|stop|项目ID|"controller&stop Taskid"|暂停物联网应用|True/False|


### 迭代历史
##### 2018-3-21  

1. 完成智能体单元模块

##### 2018-3-22

1. 添加任务循环监听处理模块
2. 更改一些智能体单元模块bug

##### 2018-3-23

1. 完成控制器基本通信模块

##### 2018-3-25

1. 在docker上测试代码（存在bug未修复）
2. 已知问题：dht11的数据类型比较奇怪，需要进行额外处理，需要相应修改workProcess代码

##### 2018-3-26
1. 完成在Docker上的第一版代码测试（已修复BUG）
2. 搭建了一套完整的本地测试系统（包括dht102和switch104）
3. 搭建同时执行多条任务代码
4. 设计多条件输入的执行逻辑

##### 2018-3-27
1. 输入与输出分别存储，并做简单映射关系。
2. 实现将控制信息转存至input和output列表中

##### 2018-4-7
1. 构建服务器后台核心代码框架,需要安装Flask Module

##### 2018-4-8
1. 完成单链表结构的代码生产
2. 完成多链表并行结构代码的功能（明日计划)
## 版本说明

##### 2018-4-9
1. 完成与寰寰前端的联通问题.（过程艰辛，不完善可能存在bug)
2. 修复listenser的一处bug
3. 实现输入与输出分离的任务执行逻辑的基础函数，剩余正在开发。

##### 2018-4-10
1. 设计实现多输入与多输出混合映射连接，发现问题，需要在输入命令前手动输入任务ID，
用来做同一组任务的唯一标识，否则无法连接多输入到单一输出。目前考虑需要重新设计数据库。

智能体虚拟化模块主要有两大功能

1. 监听控制器的配置请求
2. 监听其他传感器的控制请求

### 目前智能体支持的控制命令
|控制命令|说明|范例|
|--------|----|----|
|add|添加一条任务|controller&add&>30;192.168.1.1:3000::2:off&20|
|clear|清空任务队列|controller&clear|
|period|更新任务执行周期|controller&period&20|
|show|查看任务队列中项目|controller&show&0|

注： 控制器命令目前由`./tests/testListenSer.py`代为执行
 
### 版本目前存在问题
1. 任务队列中只能存在一条任务 (已解决)
2. 与前端通信的json解析，是个隐患。 
### 未来要支持的功能

控制器：

1. 任务队列的异常发现与处理功能
2. 控制命令支持本地命令，eg:sleep, 查询本体数据，等等

### 使用说明

|传感器名称| 映射端口 |
|----------|----------|
|dht102|33333|
|switch104|33334|
|switch103|33335|

程序范例:

当温度大于30时，启动switch104,10s后启动switch103

```
python3 testListenSer.py 33333 "controller&add&>30;192.168.12.19.3000:on:2&20"
python3 testListenSer.py 33333 "controller&add&<30;192.168.12.19:33335:on:2&0"
```

清空任务队列

```
python3 testListenSer.py 33333 "controller&clear"
```


